{% extends "game/base.html" %}
{% load character_extras %}
{% block title %}Character{% endblock %}

{% block content %}
<h2 class="mb-4"><i class="bi bi-person-lines-fill"></i> Character Overview</h2>

<div class="row">
  <!-- Left: Profile -->
  <div class="col-md-6">
    <div class="card mb-4 shadow">
      <div class="card-header bg-primary text-white">
        <i class="bi bi-person-vcard"></i> {{ character.name }}'s Profile
      </div>
      <div class="card-body">
        <p><strong>Class:</strong> {{ character.character_class|title }}</p>
        <p><strong>Level:</strong> {{ character.level }}</p>
        <p><strong>XP:</strong> {{ character.experience }} / {{ xp_needed }}</p>

        <div class="progress mb-2" style="height: 25px;">
          <div
            class="progress-bar"
            role="progressbar"
            style="width: {{ xp_progress }}%;"
            aria-valuenow="{{ xp_progress }}"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            {{ xp_progress }}%
          </div>
        </div>
        <p class="text-warning mb-4"><strong>üí∞ Gold:</strong> {{ character.gold }}</p>

        <h5 class="mt-3"><i class="bi bi-person-gear"></i> Core Stats</h5>
        <ul class="list-group mb-3">
          <li class="list-group-item"><i class="bi bi-arm-flex"></i> <strong>Strength:</strong> {{ character.strength }}</li>
          <li class="list-group-item"><i class="bi bi-brain"></i> <strong>Intelligence:</strong> {{ character.intelligence }}</li>
          <li class="list-group-item"><i class="bi bi-crosshair"></i> <strong>Dexterity:</strong> {{ character.dexterity }}</li>
          <li class="list-group-item"><i class="bi bi-heart-pulse"></i> <strong>Vitality:</strong> {{ character.vitality }}</li>
          <li class="list-group-item"><i class="bi bi-stars"></i> <strong>Luck:</strong> {{ character.luck }}</li>
        </ul>

        <h5 class="mt-3"><i class="bi bi-bar-chart-line"></i> Battle Stats</h5>
        <ul class="list-group">
          <li class="list-group-item text-danger"><strong>‚ù§ HP:</strong> {{ character.hp }} / {{ character.max_hp }}</li>
          <li class="list-group-item text-primary"><strong>üíß Mana:</strong> {{ character.mana }} / {{ character.max_mana }}</li>
          <li class="list-group-item text-warning"><strong>‚ö° Stamina:</strong> {{ character.stamina }} / {{ character.max_stamina }}</li>
          <li class="list-group-item text-info"><strong>üõ°Ô∏è Armor:</strong> {{ character.armor }} ({{ character.damage_reduction|floatformat:1 }}% DR)</li>
          <li class="list-group-item"><strong>üó°Ô∏è Physical Damage:</strong> {{ character.physical_min_damage }} ‚Äì {{ character.physical_max_damage }}</li>
          <li class="list-group-item"><strong>‚ú® Spell Power:</strong> {{ character.spell_power }}</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Right: Equipped Gear -->
  <div class="col-md-6">
    <div class="card mb-4 shadow">
      <div class="card-header bg-success text-white">
        <i class="bi bi-shield-shaded"></i> Equipped Gear
      </div>
      <div class="card-body">
        <div class="row">
          {% for slot in equipment_slots %}
            {% with item=character|get_slot:slot %}
              <div class="col-md-6 mb-3">
                <div class="border rounded p-2 h-100 d-flex flex-column justify-content-between">
                  <strong>{{ slot|capfirst }}:</strong>
                  <span>{{ item.name|default:"None" }}</span>
                  {% if item %}
                    <form method="post" action="{% url 'unequip_item' slot %}">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-outline-danger mt-2">
                        <i class="bi bi-x-circle"></i> Unequip
                      </button>
                    </form>
                  {% endif %}
                </div>
              </div>
            {% endwith %}
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Backpack -->
    <div class="card shadow">
      <div class="card-header bg-secondary text-white">
        <i class="bi bi-backpack2"></i> Backpack
      </div>
      <div class="card-body">
        {% if backpack_items %}
          <ul class="list-group">
            {% for item in backpack_items %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ item.name }}
                <form method="post" action="{% url 'equip_item' item.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-success">
                    <i class="bi bi-check2-circle"></i> Equip
                  </button>
                </form>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p>No unequipped items.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
